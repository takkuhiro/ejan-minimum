# Requirements Document

## はじめに
Ejan (いーじゃん) は、ユーザーの顔写真から最適なメイクアップスタイル（ヘアスタイル＋メイク）を提案し、段階的なチュートリアルを提供するWebアプリケーションです。本ドキュメントはMVP（Minimum Viable Product）の要件を定義します。

## Requirements

### Requirement 1: 写真アップロードとスタイル提案機能
**目的:** ユーザーとして、自分の顔写真をアップロードして、AIが生成する3つのメイクアップスタイルの提案を受けたい。これにより、自分に適したメイクアップの選択肢を得られる。

#### 受入基準

1. WHEN ユーザーがウェルカムページにアクセス THEN Ejanシステム SHALL 性別選択オプション（男性/女性/中性）を表示する
2. WHEN ユーザーが性別を選択 THEN Ejanシステム SHALL 写真アップロード画面へ遷移する
3. WHEN ユーザーが10MB以下の画像ファイルをアップロード THEN Ejanシステム SHALL 画像を受け付けて処理を開始する
4. IF アップロードされたファイルが10MBを超える THEN Ejanシステム SHALL エラーメッセージを表示してファイルサイズ制限を通知する
5. WHEN 顔写真のアップロードが完了 THEN Ejanシステム SHALL Nano Banana APIを使用して3パターンのスタイル画像生成を開始する
6. WHILE スタイル生成処理中 THE Ejanシステム SHALL ローディング画面を表示して進行状況を示す
7. WHEN スタイル生成が完了 THEN Ejanシステム SHALL 3つの異なるスタイル画像を選択可能な形式で表示する

### Requirement 2: スタイルカスタマイズ機能
**目的:** ユーザーとして、提案されたスタイルを選択またはカスタマイズして、自分の希望に合わせた調整を行いたい。

#### 受入基準

1. WHEN ユーザーがスタイル選択画面を表示 THEN Ejanシステム SHALL 各スタイルにプレビュー画像とタイトルを表示する
2. WHEN ユーザーが特定のスタイルを選択 THEN Ejanシステム SHALL そのスタイルの詳細情報（説明、必要な道具リスト）を表示する
3. IF ユーザーがカスタマイズボタンをクリック THEN Ejanシステム SHALL カスタマイズ画面へ遷移して調整オプションを提供する
4. WHEN ユーザーがカスタマイズ内容を入力 THEN Ejanシステム SHALL プロンプトとしてAI処理に反映する
5. WHERE カスタマイズ画面において THE Ejanシステム SHALL テキスト入力フィールドで自由な調整要望を受け付ける

### Requirement 3: チュートリアル生成機能
**目的:** ユーザーとして、選択したスタイルを実現するための詳細な手順を動画と画像付きのチュートリアルで確認したい。

#### 受入基準

1. WHEN ユーザーがスタイルを確定 THEN Ejanシステム SHALL Gemini Structured Output APIを使用してメイクアップ手順を構造化する
2. WHEN 手順構造化が完了 THEN Ejanシステム SHALL 各ステップごとの完成イメージ画像生成を開始する
3. WHILE 画像生成処理中 THE Ejanシステム SHALL 生成中画面を表示して予想残り時間（約3分）を通知する
4. WHEN ステップ画像生成が完了 THEN Ejanシステム SHALL Veo3 APIを使用して各ステップの解説動画生成を開始する
5. IF Veo3の動画生成がPENDING状態 THEN Ejanシステム SHALL 10秒間隔でポーリングして生成完了を確認する
6. WHEN すべての動画生成が完了 THEN Ejanシステム SHALL チュートリアル画面へ自動遷移する

### Requirement 4: チュートリアル表示機能
**目的:** ユーザーとして、生成されたチュートリアルをステップバイステップで閲覧し、実際のメイクアップを実践したい。

#### 受入基準

1. WHEN チュートリアル画面が表示される THEN Ejanシステム SHALL タイトル、説明、総ステップ数を表示する
2. WHEN ユーザーが特定のステップを選択 THEN Ejanシステム SHALL そのステップの動画、完成イメージ、詳細説明を表示する
3. WHILE 動画再生中 THE Ejanシステム SHALL 10秒間の解説動画をループ再生する
4. WHERE 各ステップ表示において THE Ejanシステム SHALL 必要な道具リストと具体的な手順を表示する
5. WHEN ユーザーが前後のステップボタンをクリック THEN Ejanシステム SHALL 対応するステップへ遷移する
6. IF ユーザーが最後のステップまで到達 THEN Ejanシステム SHALL 完了メッセージと新規作成オプションを表示する

### Requirement 5: データ保存と管理
**目的:** システムとして、生成された画像と動画を適切に保存・管理して、ユーザーへの表示を可能にしたい。

#### 受入基準

1. WHEN 画像または動画が生成される THEN Ejanシステム SHALL Google Cloud Storageに保存する
2. WHERE 保存処理において THE Ejanシステム SHALL ユニークなファイル名を生成して重複を防ぐ
3. IF ストレージへの保存が失敗 THEN Ejanシステム SHALL エラーをログに記録して再試行を実施する
4. WHEN ユーザーが画像や動画を要求 THEN Ejanシステム SHALL Cloud Storage URLを通じてコンテンツを配信する
5. WHERE デモ環境において THE Ejanシステム SHALL ユーザーセッション終了後もデータを削除せずに保持する

### Requirement 6: エラー処理とユーザビリティ
**目的:** ユーザーとして、エラーが発生した際に適切なフィードバックを受け取り、操作を継続したい。

#### 受入基準

1. IF AI API呼び出しが失敗 THEN Ejanシステム SHALL ユーザーに分かりやすいエラーメッセージを表示して再試行オプションを提供する
2. WHEN ネットワークエラーが発生 THEN Ejanシステム SHALL 接続エラーを通知して自動リトライを実施する
3. WHILE 長時間処理中 THE Ejanシステム SHALL プログレスバーまたはスピナーで処理状況を可視化する
4. IF 画像アップロードがサポート外フォーマット THEN Ejanシステム SHALL 対応フォーマット（JPEG、PNG等）を明示する
5. WHERE エラー表示において THE Ejanシステム SHALL トーストまたはモーダルでユーザーに通知する

### Requirement 7: 基本的なUI表示
**目的:** ユーザーとして、デスクトップブラウザで快適にアプリケーションを使用したい。

#### 受入基準

1. WHEN ユーザーがデスクトップブラウザでアクセス THEN Ejanシステム SHALL 適切なレイアウトで全機能を表示する
2. WHERE UI要素において THE Ejanシステム SHALL クリック可能な要素を明確に識別できるようにする
3. WHEN 画面を表示 THEN Ejanシステム SHALL 標準的なデスクトップ解像度（1920x1080以上）で正常に表示する
4. IF ブラウザウィンドウが最小推奨幅（1024px）より小さい THEN Ejanシステム SHALL 水平スクロールバーを表示する
5. WHERE 画像と動画表示において THE Ejanシステム SHALL 適切なサイズで表示して内容を確認できるようにする